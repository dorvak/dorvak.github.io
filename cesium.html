<meta charset="utf-8" content="width=device-width, initial-scale=1">
<head>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.100/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.100/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" rel="stylesheet">
    <div id="cesiumContainer" style="width:100%; height:100%;"></div>
    <style type="text/css">

        #toolbar-left {
            display: block;
            position: absolute;
            top: 5px;
            left: 5px;
        }

        .icon-bar {
            position: absolute;
            top: 30px;
            left: 30px;
            z-index: auto;
            width: 60px;
            background-color: rgba(85, 85, 85, 0.8);
        }

        .icon-bar a {
            display: block;
            text-align: center;
            padding: 16px;
            transition: all 0.3s ease;
            color: white;
            font-size: 30px;
        }

        /*        .icon-bar a:hover {
                    background-color: rgba(0, 0, 0, 0.94);
                }*/

        .active {
            background-color: #04AA6D;
        }
    </style>
</head>
<body>
<div id="toolbar-left"></div>
<div class="icon-bar">
    <a class='active' id='toggle-labels'><i class="fa fa-tag"></i></a>
    <a class='active' id='toggle-peaks'><i class="fa fa-mountain"></i></a>
    <a class='active' id="toggle-starts"><i class="fa-solid fa-plane-departure"></i></a>

</div>
<div id="baseLayerPickerContainer" style="position:absolute;top:24px;right:24px;"></div>
<script type="text/javascript">

    const imageryViewModels = [];

    imageryViewModels.push(new Cesium.ProviderViewModel({
        name: 'MapBox Outdoors',
        iconUrl: Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/openStreetMap.png"),
        tooltip: 'Mapbob Outdoors',
        creationFunction: function () {
            return new Cesium.MapboxStyleImageryProvider({
                styleId: 'outdoors-v12',
                accessToken: 'pk.eyJ1IjoidGtleWxpbmciLCJhIjoiY2xieXRvMm9pMHdjZDNxcW9seDRobzl2eSJ9.jOAFlmJaSLjscSivTnmZcA'
            });
        }
    }));

    imageryViewModels.push(new Cesium.ProviderViewModel({
        name: 'Open\u00adStreet\u00adMap',
        iconUrl: Cesium.buildModuleUrl('Widgets/Images/ImageryProviders/openStreetMap.png'),
        tooltip: 'OpenStreetMap (OSM) is a collaborative project to create a free editable \
        map of the world.\nhttp://www.openstreetmap.org',
        creationFunction: function () {
            return new Cesium.OpenStreetMapImageryProvider({
                url: 'https://a.tile.openstreetmap.org/'
            });
        }
    }));

    imageryViewModels.push(new Cesium.ProviderViewModel({
        name: 'Natural Earth\u00a0II',
        iconUrl: Cesium.buildModuleUrl('Widgets/Images/ImageryProviders/naturalEarthII.png'),
        tooltip: 'Natural Earth II, darkened for contrast.\nhttp://www.naturalearthdata.com/',
        creationFunction: function () {
            return new Cesium.TileMapServiceImageryProvider({
                url: Cesium.buildModuleUrl('Assets/Textures/NaturalEarthII')
            });
        }
    }));

    imageryViewModels.push(new Cesium.ProviderViewModel({
        name: 'MapBox Satellite',
        iconUrl: Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/esriWorldImagery.png"),
        tooltip: 'Mapbob Terrain/Satellite/',
        creationFunction: function () {
            return new Cesium.MapboxStyleImageryProvider({
                styleId: 'satellite-streets-v12',
                accessToken: 'pk.eyJ1IjoidGtleWxpbmciLCJhIjoiY2xieXRvMm9pMHdjZDNxcW9seDRobzl2eSJ9.jOAFlmJaSLjscSivTnmZcA'
            });
        }
    }));

    // Define Defaults
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJmMDM2N2E1ZC1iYTg4LTRkM' +
        'TUtYTczYi02OGNmOTBjMzJmZDQiLCJpZCI6NTAxMTEsImlhdCI6MTYxNzYyOT' +
        'czN30.6Sxab515UcbdwQKdd8uHdj3VQFXYFXZZhNi4DiAUrL8'

    var extent = Cesium.Rectangle.fromDegrees(12.594092, 47.798854, 12.694092, 47.898854);

    Cesium.Camera.DEFAULT_VIEW_RECTANGLE = extent;
    Cesium.Camera.DEFAULT_VIEW_FACTOR = 1;

    const viewer = new Cesium.Viewer("cesiumContainer", {
        animation: false,
        fullscreenButton: false,
        geocoder: false,
        baseLayerPicker: false,
        homeButton: false,
        infoBox: true,
        orderIndependentTranslucency: false,
        sceneModePicker: false,
        shadows: true,
        selectionIndicator: false,
        timeline: false,
        navigationHelpButton: false,
        navigationInstructionsInitiallyVisible: false,
        imageryProvider: false,
        terrainProvider: Cesium.createWorldTerrain({requestVertexNormals: true})
    });


    //Finally, create the baseLayerPicker widget using our view models.
    const layers = viewer.imageryLayers;
    const baseLayerPicker = new Cesium.BaseLayerPicker('baseLayerPickerContainer', {
        globe: viewer.scene.globe,
        imageryProviderViewModels: imageryViewModels
    });

    viewer.scene.globe.depthTestAgainstTerrain = true;
    //viewer.extend(Cesium.viewerCesiumInspectorMixin);
    viewer.scene.screenSpaceCameraController.enableCollisionDetection = true;
    viewer.scene.skyAtmosphere.atmosphereMieScaleHeigh = 3200;
    viewer.scene.globe.enableLighting = false;

    (async () => {
        "use strict";
        try {
            const resource = await Cesium.IonResource.fromAssetId(1471213);
            const bergen = Cesium.Cartesian3.fromDegrees(12.594092, 47.798854, 1400)
            const hpr = new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(90), 0, 0);
            const orientation = Cesium.Transforms.headingPitchRollQuaternion(
                bergen,
                hpr
            );

            const logo = viewer.entities.add({
                position: bergen,
                orientation: orientation,
                model: {
                    uri: resource,
                    scale: 9000,

                },
            });
            await viewer.flyTo(logo);
        } catch (error) {
            console.log(error);
        }
    })();

    const peaks = viewer.entities.add(new Cesium.Entity());
    const labels = viewer.entities.add(new Cesium.Entity());
    const startpl = viewer.entities.add(new Cesium.Entity());

    (async () => {
        try {
            let peak_color = Cesium.Color.fromCssColorString('#830fff').withAlpha(0.4)
            const resource = await Cesium.IonResource.fromAssetId(1471201);
            const dataSource = await Cesium.GeoJsonDataSource.load(resource, {clampToGround: true});
            for (const entity of dataSource.entities.values) {
                entity.billboard = undefined;
                entity.parent = peaks;
                entity.cylinder = new Cesium.CylinderGraphics({
                    show: true, bottomRadius: 200, topRadius: 200,
                    length: 2000, heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
                    material: peak_color
                });
                let entity_pos = entity.position.getValue();
                let entity_cart = new Cesium.Cartesian3(entity_pos['x'], entity_pos['y'], entity_pos['z'])
                var entity_deg = Cesium.Ellipsoid.WGS84.cartesianToCartographic(entity_cart);

                entity_deg = Cesium.Cartesian3.fromDegrees(
                    Cesium.Math.toDegrees(entity_deg.longitude),
                    Cesium.Math.toDegrees(entity_deg.latitude),
                    entity.properties.elevation.getValue() * 0.3048 + 2200
                );
                await viewer.entities.add({
                    position: entity_deg,
                    parent: labels,
                    label: {
                        translucencyByDistance: new Cesium.NearFarScalar(20000, 1.0, 95000, 0.0),
                        text: entity.properties.peakname.valueOf().split(',').shift(),
                        fillColor: Cesium.Color.fromCssColorString("#ffffff"),
                        show: true,
                        horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                        verticalOrigin: Cesium.VerticalOrigin.CENTER,
                        heightReference: Cesium.HeightReference.NONE
                    }
                })
            }
            await viewer.dataSources.add(dataSource);
            //await viewer.flyTo(logo);
        } catch (error) {
            console.log(error);
        }
    })();


    (async () => {
        try {
            const resource = await Cesium.IonResource.fromAssetId(1472144);
            const startplatz_model = await Cesium.IonResource.fromAssetId(1471195);
            const dataSource = await Cesium.GeoJsonDataSource.load(resource, {clampToGround: true});
            const bergen = Cesium.Cartesian3.fromDegrees(12.594092, 47.798854, 1400)
            const hpr = new Cesium.HeadingPitchRoll(0, Cesium.Math.toRadians(90), 0);
            const orientation = Cesium.Transforms.headingPitchRollQuaternion(
                bergen,
                hpr
            );
            for (const entity of dataSource.entities.values) {
                entity.billboard = undefined;
                await viewer.entities.add({
                    position: entity.position,
                    orientation: orientation,
                    parent: startpl,
                    model: {
                        uri: startplatz_model,
                        scale: 500,
                        show: true,
                        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND

                    },
                });
            }
            await viewer.dataSources.add(dataSource);

        } catch (error) {
            console.log(error);
        }
    })();

    function showntoggle(layer) {
        return function () {
            layer.show = !layer.show
            this.classList.toggle('active')
        }
    }

    document.querySelector('#toggle-peaks').addEventListener('click', showntoggle(peaks))
    document.querySelector('#toggle-labels').addEventListener('click', showntoggle(labels))
    document.querySelector('#toggle-starts').addEventListener('click', showntoggle(startpl))

    let editHandler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);

    /*    editHandler.setInputAction(function (e) {
            var shapeEditMenu = document.getElementById("toolbar-left");
            shapeEditMenu.textContent = 'Testing';
            shapeEditMenu.style.display = "block";
            shapeEditMenu.style.left = e.position.x + 'px';
            shapeEditMenu.style.top = e.position.y + 'px';
            shapeEditMenu.style.background = 'rgba(42, 42, 42, 0.8)';
            shapeEditMenu.style.border = '1px solid #888';
        }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);

        editHandler.setInputAction(function (e) {
            var shapeEditMenu = document.getElementById("toolbar-left");
            shapeEditMenu.style.display = "none";
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);*/
</script>
</body>
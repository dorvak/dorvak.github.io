<meta charset="utf-8">
<head>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.100/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.100/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <div id="cesiumContainer" style="width:100%; height:100%;"></div>
    <style type="text/css">
        #toggle-peaks {
            z-index: 1;
            position: fixed;
            top: 30px;
            left: 30px;
            border-radius: 4px;
            background-color: cornflowerblue
        }

        #toggle-labels {
            z-index: 1;
            position: absolute;
            top: 60px;
            left: 30px;
            border-radius: 4px;
            background-color: cornflowerblue
        }

        #toggle-starts {
            z-index: 1;
            position: absolute;
            top: 90px;
            left: 30px;
            border-radius: 4px;
            background-color: cornflowerblue
        }

        #toolbar-left {
            display: block;
            position: absolute;
            top: 5px;
            left: 5px;
        }
    </style>
</head>
<body>
<button id="toggle-peaks">Show SummIt Cylinders</button>
<button id="toggle-labels">Show SummIt Labels</button>
<button id="toggle-starts">Show SummIt Take-Offs</button>
<div id="toolbar-left"></div>
<script type="text/javascript">
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJmMDM2N2E1ZC1iYTg4LTRkM' +
        'TUtYTczYi02OGNmOTBjMzJmZDQiLCJpZCI6NTAxMTEsImlhdCI6MTYxNzYyOT' +
        'czN30.6Sxab515UcbdwQKdd8uHdj3VQFXYFXZZhNi4DiAUrL8'
    const viewer = new Cesium.Viewer("cesiumContainer", {
        animation: false,
        baseLayerPicker: true,
        fullscreenButton: false,
        geocoder: false,
        homeButton: true,
        infoBox: true,
        orderIndependentTranslucency: false,
        sceneModePicker: false,
        shadows: true,
        selectionIndicator: false,
        timeline: false,
        navigationHelpButton: true,
        navigationInstructionsInitiallyVisible: false,
        imageryProvider: new Cesium.MapboxStyleImageryProvider({
            styleId: 'satellite-streets-v12',
            accessToken: 'pk.eyJ1IjoidGtleWxpbmciLCJhIjoiY2xieXRvMm9pMHdjZDNxcW9seDRobzl2eSJ9.jOAFlmJaSLjscSivTnmZcA'
        }),
        terrainProvider: Cesium.createWorldTerrain({requestVertexNormals: true})
    });

    viewer.scene.globe.depthTestAgainstTerrain = true;
    //viewer.extend(Cesium.viewerCesiumInspectorMixin);
    viewer.scene.screenSpaceCameraController.enableCollisionDetection = true;
    viewer.scene.skyAtmosphere.atmosphereMieScaleHeigh = 3200;
    viewer.scene.globe.enableLighting = false;

    (async () => {
        "use strict";
        try {
            const resource = await Cesium.IonResource.fromAssetId(1471213);
            const bergen = Cesium.Cartesian3.fromDegrees(12.594092, 47.798854, 1400)
            const hpr = new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(90), 0, 0);
            const orientation = Cesium.Transforms.headingPitchRollQuaternion(
                bergen,
                hpr
            );

            const logo = viewer.entities.add({
                position: bergen,
                orientation: orientation,
                model: {
                    uri: resource,
                    scale: 9000,

                },
            });
            await viewer.flyTo(logo);
        } catch (error) {
            console.log(error);
        }
    })();

    const peaks = viewer.entities.add(new Cesium.Entity());
    const labels = viewer.entities.add(new Cesium.Entity());
    const startpl = viewer.entities.add(new Cesium.Entity());

    (async () => {
        try {
            let peak_color = Cesium.Color.fromCssColorString('#ffc80f').withAlpha(0.5)
            const resource = await Cesium.IonResource.fromAssetId(1471201);
            const dataSource = await Cesium.GeoJsonDataSource.load(resource, {clampToGround: true});
            for (const entity of dataSource.entities.values) {
                entity.billboard = undefined;
                entity.parent = peaks;
                entity.cylinder = new Cesium.CylinderGraphics({
                    show: true, bottomRadius: 200, topRadius: 200,
                    length: 2000, heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
                    material: peak_color
                });
                let entity_pos = entity.position.getValue();
                let entity_cart = new Cesium.Cartesian3(entity_pos['x'], entity_pos['y'], entity_pos['z'])
                var entity_deg = Cesium.Ellipsoid.WGS84.cartesianToCartographic(entity_cart);

                entity_deg = Cesium.Cartesian3.fromDegrees(
                    Cesium.Math.toDegrees(entity_deg.longitude),
                    Cesium.Math.toDegrees(entity_deg.latitude),
                    entity.properties.elevation.getValue() * 0.3048 + 2000
                );
                await viewer.entities.add({
                    position: entity_deg,
                    parent: labels,
                    label: {
                        translucencyByDistance: new Cesium.NearFarScalar(20000, 1.0, 95000, 0.0),
                        text: entity.properties.peakname.valueOf().split(',').shift(),
                        fillColor: Cesium.Color.fromCssColorString("#41413DFF"),
                        show: true,
                        horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                        verticalOrigin: Cesium.VerticalOrigin.CENTER,
                        heightReference: Cesium.HeightReference.NONE
                    }
                })
            }
            await viewer.dataSources.add(dataSource);
            //await viewer.flyTo(logo);
        } catch (error) {
            console.log(error);
        }
    })();


    (async () => {
        try {
            const resource = await Cesium.IonResource.fromAssetId(1472144);
            const startplatz_model = await Cesium.IonResource.fromAssetId(1471195);
            const dataSource = await Cesium.GeoJsonDataSource.load(resource, {clampToGround: true});
            const bergen = Cesium.Cartesian3.fromDegrees(12.594092, 47.798854, 1400)
            const hpr = new Cesium.HeadingPitchRoll(0, Cesium.Math.toRadians(90), 0);
            const orientation = Cesium.Transforms.headingPitchRollQuaternion(
                bergen,
                hpr
            );
            for (const entity of dataSource.entities.values) {
                entity.billboard = undefined;
                await viewer.entities.add({
                    position: entity.position,
                    orientation: orientation,
                    parent: startpl,
                    model: {
                        uri: startplatz_model,
                        scale: 500,
                        show: true,
                        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND

                    },
                });
            }
            await viewer.dataSources.add(dataSource);

        } catch (error) {
            console.log(error);
        }
    })();


    document.querySelector('#toggle-peaks').onclick = function () {
        peaks.show = !peaks.show;
    };
    document.querySelector('#toggle-labels').onclick = function () {
        labels.show = !labels.show;
    };
    document.querySelector('#toggle-starts').onclick = function () {
        startpl.show = !startpl.show;
    };

    var editHandler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);

    /*    editHandler.setInputAction(function (e) {
            var shapeEditMenu = document.getElementById("toolbar-left");
            shapeEditMenu.textContent = 'Testing';
            shapeEditMenu.style.display = "block";
            shapeEditMenu.style.left = e.position.x + 'px';
            shapeEditMenu.style.top = e.position.y + 'px';
            shapeEditMenu.style.background = 'rgba(42, 42, 42, 0.8)';
            shapeEditMenu.style.border = '1px solid #888';
        }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);

        editHandler.setInputAction(function (e) {
            var shapeEditMenu = document.getElementById("toolbar-left");
            shapeEditMenu.style.display = "none";
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);*/
</script>
</body>